<?php
date_default_timezone_set('Asia/Ho_Chi_Minh');
error_reporting(0);
// B·∫Øt s·ª± ki·ªán ^C (Ctrl+C)
declare(ticks=1);
pcntl_signal(SIGINT, function() {
    slowEcho(color("=> C·∫£m ∆°n b·∫°n ƒë√£ s·ª≠ d·ª•ng tool! H·∫πn g·∫∑p l·∫°i.\n", "1;32"));
    exit;
});


// H√†m hi·ªÉn th·ªã t·ª´ t·ª´
if (!function_exists('slowEcho')) {
function slowEcho($text, $delay = 500) {
    foreach (str_split($text) as $char) {
        echo $char;
        usleep($delay);
    }
 }
}

// H√†m m√†u
if (!function_exists('color')) {
function color($text, $color_code) {
    return "\033[".$color_code."m".$text."\033[0m";
}
}

if (!function_exists('rainbow')) {
function rainbow($text) {
    $colors = ['1;31','1;33','1;32','1;36','1;34','1;35'];
    $out = '';
    $i = 0;
    foreach (str_split($text) as $char) {
        $out .= "\033[" . $colors[$i % count($colors)] . "m$char";
        $i++;
    }
    return $out . "\033[0m";
}
}
// Logo & Info
if (!function_exists('showLogo')) {
function showLogo() {
    $logo = <<<LOGO
______  ___   _   _ _____  _____ ___________ ___________  
|  _  \/ _ \ | \ | |  __ \/  __ \  _  |  _  \  ___| ___ \ 
| | | / /_\ \|  \| | |  \/| /  \/ | | | | | | |__ | |_/ / 
| | | |  _  || . ` | | __ | |   | | | | | | |  __||    /  
| |/ /| | | || |\  | |_\ \| \__/\ \_/ / |/ /| |___| |\ \  
|___/ \_| |_/\_| \_/\____/ \____/\___/|___/ \____/\_| \_|
LOGO;
    slowEcho(rainbow($logo) . "\n", 500); // hi·ªÉn th·ªã logo v·ªõi t·ªëc ƒë·ªô ch·∫≠m h∆°n
}
}
//L·ª±a Ch·ªçn TOOL
if (!function_exists('showInfo')) {
function showInfo() {
    $lines = [
        color(" T√™n tool: ", "1;36") . color("Tool TDS TIKTOK + TTC TIKTOK SI√äU L·ªé", "1;33"),
        color(" T√°c gi·∫£: ", "1;36") . color("DangCoder", "1;35"),
        color(" Website: ", "1;36") . color("https://facebook.com/dangcoder", "1;32"),
        color(" Li√™n h·ªá: ", "1;36") . color("https://zalo.me/dangcoder", "1;34"),
    ];
    $border = str_repeat("-", 50);
    slowEcho(color("+$border+\n", "1;33"));
    foreach ($lines as $line) {
        $space = 48 - strlen(strip_tags($line));
        $space = max($space, 0);
        slowEcho(color("| ", "1;33") . color($line . str_repeat(" ", $space), "1;31") . color(" |\n", "1;33"));
    }
    slowEcho(color("+$border+\n", "1;33"));
}
}
// Key



// B·∫Øt ƒë·∫ßu
system("clear");
showLogo();
showInfo();


//Hi·ªÉn th·ªã banner
echo color("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n", "1;39");
echo color("‚ïë     ", "1;39") . color("ƒêƒÇNG NH·∫¨P GOLIKE AUTH", "1;36") . color("      ‚ïë\n", "1;39");
echo color("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n", "1;39");

// Kh·ªüi t·∫°o file n·∫øu ch∆∞a c√≥
if (!file_exists("Authorization.txt")) file_put_contents("Authorization.txt", "");
if (!file_exists("token.txt")) file_put_contents("token.txt", "");

$author = trim(file_get_contents("Authorization.txt"));
$token = trim(file_get_contents("token.txt"));

// Nh·∫≠p auth n·∫øu ch∆∞a c√≥
if ($author == "") {
    echo color(" üí∏ NH·∫¨P AUTHORIZATION GOLIKE : ", "1;32");
    $author = trim(fgets(STDIN));
    echo color(" üí∏ NH·∫¨P TOKEN (T C·ª¶A GOLIKE): ", "1;32");
    $token = trim(fgets(STDIN));
    file_put_contents("Authorization.txt", $author);
    file_put_contents("token.txt", $token);
} else {
    echo color("Nh·∫≠p 1 ƒë·ªÉ v√†o TOOL Golike\n", "1;32");
    echo color("     HO·∫∂C L√Ä\n", "1;36");
    echo color("Nh·∫≠p AUTHORIZATION ·ªü ƒë√¢y ƒë·ªÉ v√†o acc golike kh√°c : ", "1;32");
    $chon = trim(fgets(STDIN));
    if ($chon != "1") {
        $author = $chon;
        echo color("üöÄ Nh·∫≠p T : ", "1;32");
        $token = trim(fgets(STDIN));
        file_put_contents("Authorization.txt", $author);
        file_put_contents("token.txt", $token);
    }
}

// X√≥a m√†n h√¨nh
system('clear');

// H√†m headers
function getHeaders($auth, $token) {
    return [
        "Accept: application/json, text/plain, */*",
        "Content-Type: application/json;charset=utf-8",
        "Authorization: $auth",
        "t: $token",
        "User-Agent: Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Mobile Safari/537.36",
        "Referer: https://app.golike.net/account/manager/tiktok"
    ];
}

// H√†m l·∫•y th√¥ng tin ng∆∞·ªùi d√πng
function getUserInfo($auth, $token) {
    $url = "https://gateway.golike.net/api/users/me";
    $headers = getHeaders($auth, $token);
    $ch = curl_init($url);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_HTTPHEADER => $headers,
    ]);
    $res = curl_exec($ch);
    curl_close($ch);
    return json_decode($res, true);
}

// Th√¥ng tin t√†i kho·∫£n
$userInfo = getUserInfo($author, $token);

if (!isset($userInfo['status']) || $userInfo['status'] != 200) {
    echo color("üò† Authorization ho·∫∑c T sai r·ªìi b·∫°n ∆°i! üò≠\n", "1;31");
    exit;
}

// ‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng
$name = $userInfo['data']['name'];
$username = $userInfo['data']['username'];
$tien = $userInfo['data']['coin'];
echo color("ƒêƒÉng nh·∫≠p t√†i kho·∫£n th√†nh c√¥ng!\n", "1;32");
echo color("T√™n t√†i kho·∫£n: ", "1;36") . color($name . "\n", "1;33");
echo color(" Username: ", "1;36") . color($username . "\n", "1;33");
echo color("Ti·ªÅn Hi·ªán C√≥: ", "1;36") . color($tien . "\n", "1;33");
sleep(2);

// L·∫•y danh s√°ch acc TikTok
function getTikTokAccounts($auth, $token) {
    $url = "https://gateway.golike.net/api/tiktok-account";
    $headers = getHeaders($auth, $token);
    $ch = curl_init($url);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_HTTPHEADER => $headers,
    ]);
    $res = curl_exec($ch);
    curl_close($ch);
    return json_decode($res, true);
}

// In danh s√°ch TikTok
echo color("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n", "1;39");
echo color("‚ïë   ", "1;39") . color("DANH S√ÅCH ACC TIKTOK TRONG ACC GOLIKE", "1;36") . color("    ‚ïë\n", "1;39");
echo color("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n", "1;39");

$response = getTikTokAccounts($author, $token);

if (!isset($response['status']) || $response['status'] != 200) {
    echo color("üò† Kh√¥ng th·ªÉ l·∫•y danh s√°ch TikTok. Ki·ªÉm tra l·∫°i token!\n", "1;31");
    exit;
}

$accs = $response['data'];
foreach ($accs as $i => $acc) {
    echo color("[".($i+1)."] ", "1;36") . color($acc['nickname'], "1;93") . color(" | ", "1;97") . color("‚úÖ Online\n", "1;32");
}
echo color("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n", "1;35");
// ======= CH·ªåN ACC TIKTOK =======
echo "[\033[1;31m‚ù£\033[0m] \033[1;36m‚úà\033[0m " . color("Ch·ªçn t√†i kho·∫£n TikTok mu·ªën ch·∫°y: ", "1;33");
while (true) {
    $chonAcc = intval(trim(fgets(STDIN)));
    if (isset($response['data'][$chonAcc - 1])) {
        $tiktokId = $response['data'][$chonAcc - 1]['id'];
        break;
    }
    echo color("‚ùå Kh√¥ng h·ª£p l·ªá, ch·ªçn l·∫°i: ", "1;31");
}

// ======= NH·∫¨P DELAY =======
while (true) {
    echo color("‚è≥ Nh·∫≠p delay gi·ªØa c√°c job (gi√¢y): ", "1;32");
    $delay = intval(trim(fgets(STDIN)));
    if ($delay > 0) break;
    echo color("‚ùå Delay ph·∫£i l√† s·ªë > 0\n", "1;31");
}

// ======= NH·∫¨N TI·ªÄN L·∫¶N 2 =======
echo color("üí∏ C√≥ nh·∫≠n ti·ªÅn l·∫ßn 2 kh√¥ng? (y/n): ", "1;33");
$lan2 = strtolower(trim(fgets(STDIN)));
$nhanlan2 = ($lan2 == 'y');
echo color("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n", "1;35");

/// ======= B·∫ÆT ƒê·∫¶U GET JOB =======
$daLam = []; // danh s√°ch job ƒë√£ l√†m
$dem = 0;
$tongTien = 0;

// ‚úÖ B·∫£ng ti√™u ƒë·ªÅ c·ªë ƒë·ªãnh
  echo "\033[1;36m‚îÇ\033[0m \033[1;33mSTT\033[0m  \033[1;36m‚îÇ\033[0m \033[1;33mTh·ªùi gian\033[0m \033[1;36m‚îÇ\033[0m \033[1;32mStatus \033[0m \033[1;36m‚îÇ\033[0m \033[1;31mType Job\033[0m \033[1;36m‚îÇ\033[0m \033[1;37mID Acc\033[0m \033[1;36m‚îÇ\033[0m \033[1;32mXu\033[0m   \033[1;36m‚îÇ\033[0m \033[1;33mT·ªïng\033[0m \033[1;36m‚îÇ\033[0m\n";
echo color("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n", "1;35");
     usleep(500);

while (true) {
   $text = "ƒêang t√¨m nhi·ªám v·ª•";
echo color($text, "1;36");
    $jobData = getJobs($author, $token, $tiktokId);
    // X√≥a d√≤ng "ƒêang t√¨m nhi·ªám v·ª•..."
clearLine($text);
   usleep(300000);
    if (!isset($jobData['data']) || !isset($jobData['data']['id'])) {
    $textvip = "Kh√¥ng c√≥ job, ƒë·ª£i 5s";
   echo color($textvip, "1;31");
    sleep(5);
     clearLine($text);
    continue;
}


    $job = $jobData['data'];
    $jobId = $job['id'];
    $link = $job['link'];
    $job_type = strtoupper($job['type']);

    if (in_array($jobId, $daLam)) {
        echo color("‚ö†Ô∏è B·ªè qua job tr√πng ID $jobId\n", "1;33");
        sleep(2);
        continue;
    }

    if (empty($link) || !filter_var($link, FILTER_VALIDATE_URL)) {
        echo color("‚ùå Link kh√¥ng h·ª£p l·ªá. B·ªè qua...\n", "1;31");
        sleep(2);
        continue;
    }

    //echo color("üëâ Nhi·ªám v·ª•: $job_type\n", "1;36");
    //echo color("üåê Link: ", "1;36") . color("$link\n", "1;34");
    system("termux-open-url '$link'");

   delay($delay);

    // G·ªçi l·∫ßn 1
    $hoanthanh = completeJob($author, $token, $jobId, $tiktokId);
    $tien = $hoanthanh['data']['prices'];

    if ($hoanthanh['status'] == 200 && $tien > 0) {
        $dem++;
        $tongTien += $tien;
    } else {
        // N·∫øu ch·ªçn nh·∫≠n ti·ªÅn l·∫ßn 2
        if ($nhanlan2) {
            echo color("Th·ª≠ l·∫°i ho√†n th√†nh job l·∫ßn 2", "1;33");
            sleep(6);
            clearCurrentLine();
            $hoanthanh2 = completeJob($author, $token, $jobId, $tiktokId);
            $tien2 = $hoanthanh2['data']['prices'];
            $tien = $tien2;
          


            if ($hoanthanh2['status'] == 200 && $tien2 > 0) {
                $dem++;
                $tongTien += $tien2;
            } else {
                // ‚ùå Sau 2 l·∫ßn v·∫´n fail ‚Üí b√°o l·ªói + skip job
                echo color("Kh√¥ng ho√†n th√†nh job $jobId sau 2 l·∫ßn. ƒêang g·ª≠i b√°o l·ªói", "1;31");
               clearCurrentLine();
         $object_id = $jobData['data']['object_id'];
         $ads_id = $jobData['data']['id'];
                if (!$object_id) {
                    echo color("‚ö†Ô∏è Thi·∫øu object_id, kh√¥ng th·ªÉ skip job!\n", "1;33");
                } else {
                    $skip = baoloi($author, $token, $ads_id, $object_id, $tiktokId);
                    if (isset($skip['status']) && $skip['status'] == 200) {
                        echo color("ƒê√£ B·ªè qua Job N√†y", "1;31");
                        sleep(2);
                        clearCurrentLine();
                    } else {
                        echo color("‚ùå Skip job th·∫•t b·∫°i!\n", "1;31");
                        print_r($skip);
                    }
                }
                $daLam[] = $jobId;
                continue;
            }
        } else {
            // ‚ùå Kh√¥ng nh·∫≠n ti·ªÅn l·∫ßn 2 ‚Üí skip lu√¥n
            echo color("‚ùå Kh√¥ng ho√†n th√†nh job $jobId\n", "1;31");
            $object_id = $jobData['data']['object_id'];
            $ads_id = $jobData['data']['id'];
            if (!$object_id) {
                echo color("‚ö†Ô∏è Thi·∫øu object_id, kh√¥ng th·ªÉ skip job!\n", "1;33");
            } else {
                $skip = baoloi($author, $token, $ads_id, $object_id, $tiktokId);
                if (isset($skip['status']) && $skip['status'] == 200) {
                    echo color("‚úÖ B√°o l·ªói + Skip job $jobId th√†nh c√¥ng!\n", "1;32");
                } else {
                    echo color("‚ùå Skip job th·∫•t b·∫°i!\n", "1;31");
                    print_r($skip);
                }
            }
            $daLam[] = $jobId;
            continue;
        }
    }

    // Hi·ªÉn th·ªã d√≤ng k·∫øt qu·∫£ v√†o b·∫£ng
 $time = getdate();
    $h = str_pad($time['hours'], 2, "0", STR_PAD_LEFT);
    $m = str_pad($time['minutes'], 2, "0", STR_PAD_LEFT);
    $s = str_pad($time['seconds'], 2, "0", STR_PAD_LEFT);
$stt++;

printf(
    "\033[1;36m‚îÇ\033[0m \033[1;31m%-3s\033[0m \033[1;36m‚îÇ\033[0m \033[1;33m%02d:%02d:%02d \033[0m\033[1;36m‚îÇ\033[0m \033[1;32m%-7s\033[0m \033[1;36m‚îÇ\033[0m \033[1;31m%-8s\033[0m \033[1;36m‚îÇ\033[0m \033[1;37m%-6s\033[0m \033[1;36m‚îÇ\033[0m \033[1;32m+%-2s\033[0m \033[1;36m‚îÇ\033[0m \033[1;33m%-4s\033[0m \033[1;36m‚îÇ\033[0m\n",
    $stt, $h, $m, $s, "success", $job_type, "·∫®n ID", $tien, $tongTien
);
}

// ======= H√ÄM GET JOB =======
function getJobs($auth, $token, $accountId) {
    $url = "https://gateway.golike.net/api/advertising/publishers/tiktok/jobs";
    $headers = getHeaders($auth, $token);
    
    $params = http_build_query([
        'account_id' => $accountId,
        'data' => 'null'
    ]);

    $ch = curl_init($url . '?' . $params);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_HTTPHEADER => $headers,
    ]);

    $res = curl_exec($ch);
    curl_close($ch);

    return json_decode($res, true);
}

// ======= H√ÄM COMPLETE JOB =======
function completeJob($auth, $token, $ads_id, $accountId) {
    $url = "https://gateway.golike.net/api/advertising/publishers/tiktok/complete-jobs";

    $json_data = json_encode([
        'ads_id' => $ads_id,
        'account_id' => $accountId,
        'async' => true,
        'data' => null,
    ]);

    $headers = array_merge(getHeaders($auth, $token), [
        "Content-Type: application/json",
        "Content-Length: " . strlen($json_data)
    ]);

    $ch = curl_init($url);
    curl_setopt_array($ch, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_POST => true,
        CURLOPT_POSTFIELDS => $json_data,
        CURLOPT_HTTPHEADER => $headers,
        CURLOPT_TIMEOUT => 6
    ]);

    $res = curl_exec($ch);
    curl_close($ch);

    return json_decode($res, true);
}

// ======= H√ÄM SKIP JOB =======
function baoloi($auth, $token, $ads_id, $object_id, $account_id, $loai = 'tiktok') {
    $headers = array_merge(getHeaders($auth, $token), [
        "Content-Type: application/json"
    ]);

    // B∆∞·ªõc 1: B√°o l·ªói job
    $reportData = json_encode([
        'description' => 'T√¥i ƒë√£ l√†m Job n√†y r·ªìi',
        'users_advertising_id' => $ads_id,
        'type' => 'ads',
        'provider' => 'tiktok',
        'fb_id' => $account_id,
        'error_type' => 6,
    ]);

    $ch1 = curl_init('https://gateway.golike.net/api/report/send');
    curl_setopt_array($ch1, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_POST => true,
        CURLOPT_POSTFIELDS => $reportData,
        CURLOPT_HTTPHEADER => $headers,
    ]);
    curl_exec($ch1);
    curl_close($ch1);

    // B∆∞·ªõc 2: Skip job n√¢ng cao
    $skipData = json_encode([
        'ads_id' => $ads_id,
        'object_id' => $object_id,
        'account_id' => $account_id,
        'type' => $loai,
    ]);

    $ch2 = curl_init('https://gateway.golike.net/api/advertising/publishers/tiktok/skip-jobs');
    curl_setopt_array($ch2, [
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_POST => true,
        CURLOPT_POSTFIELDS => $skipData,
        CURLOPT_HTTPHEADER => $headers,
    ]);
    $response = curl_exec($ch2);
    curl_close($ch2);

    return json_decode($response, true);
}

//H√ÄM DELAY
function delay($delay) {
    $colors = ['1;31','1;33','1;32','1;36','1;34','1;35']; // C·∫ßu v·ªìng
    $msg = "Vui l√≤ng ch·ªù";


    for ($tt = $delay; $tt >= 1; $tt--) {
        for ($frame = 0; $frame < count($colors); $frame++) {
            $rainbow_text = "";

            // √Åp d·ª•ng m√†u t·ª´ng k√Ω t·ª±, x·ª≠ l√Ω UTF-8
            for ($i = 0; $i < mb_strlen($msg); $i++) {
                $char = mb_substr($msg, $i, 1);
                $color_code = $colors[($i + $frame) % count($colors)];
                $rainbow_text .= "\033[" . $color_code . "m" . $char;
            }

            // In d√≤ng kh√¥ng nh·∫£y, kh√¥ng ch·∫•m tr√≤n
            echo "\r\033[0m(‚óî‚Äø‚óî) " . $rainbow_text . "\033[0m ";
            echo "\033[1;93m$tt\033[0m \033[1;91mGi√¢y   "; // th√™m kho·∫£ng tr·∫Øng xo√° ph·∫ßn d∆∞

            usleep(150000); // 0.15s m·ªói frame
        }
    }

    // Hi·ªán l·∫°i con tr·ªè
    // Clear d√≤ng
    echo "\r" . str_repeat(" ", 50) . "\r";
}
//FUNCTION XO√Å D√íNG
function clearLine($text) {
    echo "\r" . str_repeat(" ", mb_strlen($text)) . "\r";
}
//jj
function clearCurrentLine() {
    // Di chuy·ªÉn v·ªÅ ƒë·∫ßu d√≤ng, xo√° h·∫øt d√≤ng
    echo "\r\033[K";
}
